<!DOCTYPE html>
<html lang="es"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Protractor en legacy code - Blog de Fabio Rueda</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.fabio.rueda.guru/protractor-en-legacy-code.html">

        <meta name="author" content="Fabio Rueda" />
        <meta name="keywords" content="tests,jasmine,nodejs,js,javascript,e2e,selenium,protractor" />
        <meta name="description" content="Introduccion Digamos que entras en un proyecto donde existe una aplicacion con varios años en produccion, que usa como unicas librerias require y jQuery, todo lo demas esta hecho a mano, ademas como puedes suponer, no tiene ni un solo test. Nos proponemos hacer tests sobre el codigo existente y ..." />

    <!-- Enable latex plugin -->



    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@avances123">
        <meta name="twitter:creator" content="@avances123">
    <meta name="twitter:domain" content="http://blog.fabio.rueda.guru">

    

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.fabio.rueda.guru/" class="navbar-brand">
Blog de Fabio Rueda            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://blog.fabio.rueda.guru/category/js.html">Js</a>
                        </li>
                        <li >
                            <a href="http://blog.fabio.rueda.guru/category/postgresql.html">Postgresql</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.fabio.rueda.guru/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archivo</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.fabio.rueda.guru/protractor-en-legacy-code.html"
                       rel="bookmark"
                       title="Permalink to Protractor en legacy code">
                        Protractor en legacy code
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">




<span class="label label-default">Tags</span>
	<a href="http://blog.fabio.rueda.guru/tag/tests.html">tests</a>
        /
	<a href="http://blog.fabio.rueda.guru/tag/jasmine.html">jasmine</a>
        /
	<a href="http://blog.fabio.rueda.guru/tag/nodejs.html">nodejs</a>
        /
	<a href="http://blog.fabio.rueda.guru/tag/js.html">js</a>
        /
	<a href="http://blog.fabio.rueda.guru/tag/javascript.html">javascript</a>
        /
	<a href="http://blog.fabio.rueda.guru/tag/e2e.html">e2e</a>
        /
	<a href="http://blog.fabio.rueda.guru/tag/selenium.html">selenium</a>
        /
	<a href="http://blog.fabio.rueda.guru/tag/protractor.html">protractor</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h3>Introduccion</h3>
<p>Digamos que entras en un proyecto donde existe una aplicacion con varios años en produccion, que usa como unicas librerias require y jQuery, todo lo demas esta hecho a mano, ademas como puedes suponer, no tiene ni un solo test.</p>
<p>Nos proponemos hacer tests sobre el codigo existente y asi implantarlos para futuras features.</p>
<h3>WebdriverJs (Selenium)</h3>
<p><a href="http://docs.seleniumhq.org/projects/webdriver/">Selenium</a> es un driver que automatiza interacciones con el explorador</p>
<p>Lo instalaremos y ejecutaremos como un paquete de nodejs, de esta manera</p>
<div class="highlight"><pre>sudo npm install -g webdriver-manager
sudo webdriber-manager update 
sudo webdriber-manager start
</pre></div>


<h3>Protractor</h3>
<p><a href="https://www.npmjs.org/package/protractor">Protractor</a> es un sistemas para ejecutar test e2e de aplicaciones angularjs, es decir, abre un explorador, (o no), y hace cliks, rellena campos y lo que haria el usuario de manera automatica. Como wrapper de selenium para angularjs, diremos que tambien se puede usar para aplicaciones no-angularjs</p>
<p>Lo instalamos en el sistema:</p>
<div class="highlight"><pre>sudo npm install -g protractor
</pre></div>


<p>Y despues creamos un fichero de configuracion, como no tenemos angular hay que configurarlo con un par de cosillas</p>
<ul>
<li>Diremos donde estan nuestros ficheros con tests de Jasmine en la variable specs</li>
<li>Y despues le diremos nuestros delays en la aplicacion, y que se olvide de la sincronizacion que hace con una app angular</li>
</ul>
<div class="highlight"><pre><span class="c1">// conf.js</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">seleniumAddress</span><span class="o">:</span> <span class="s1">&#39;http://localhost:4444/wd/hub&#39;</span><span class="p">,</span>
  <span class="nx">specs</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;spec.js&#39;</span><span class="p">],</span>

  <span class="nx">onPrepare</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// implicit and page load timeouts</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">manage</span><span class="p">().</span><span class="nx">timeouts</span><span class="p">().</span><span class="nx">pageLoadTimeout</span><span class="p">(</span><span class="mi">20000</span><span class="p">);</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">manage</span><span class="p">().</span><span class="nx">timeouts</span><span class="p">().</span><span class="nx">implicitlyWait</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>

    <span class="c1">// for non-angular page</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">ignoreSynchronization</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="c1">// Maximized chrome window</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">manage</span><span class="p">().</span><span class="nb">window</span><span class="p">().</span><span class="nx">maximize</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3>Un test sencillo</h3>
<p>Ahora crearemos un test sencillo, sacado el tutorial de protractor (muy util), en nuestro fichero specs.js:</p>
<div class="highlight"><pre><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;angularjs homepage&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should have a title&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://juliemr.github.io/protractor-demo/&#39;</span><span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">browser</span><span class="p">.</span><span class="nx">getTitle</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s1">&#39;Super Calculator&#39;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>Y ejecutamos protractor:</p>
<div class="highlight"><pre>protractor conf.js
</pre></div>


<h3>Chrome y PhantomJS</h3>
<p>Hasta ahora estamos viendo nuestra ventana de chrome pasando los tests, pero si quisieramos pasarlos en un servidor de integracion continua, deberiamos usar un explorador headless, ya que es posible que este servidor no tenga servidor grafico para GUIs.</p>
<p>Para eso usaremos phantomjs, como en los anteriores paquetes:</p>
<div class="highlight"><pre>sudo npm install -g phantomjs
</pre></div>


<p>Cambiaremos nuestro conf.js para que use phantomjs y ya lo tendremos headless.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5455185a630e0def"></script>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'avances123'; // required: replace example with your forum shortname

                    var disqus_identifier = 'protractor-en-legacy-code';
                var disqus_url = 'http://blog.fabio.rueda.guru/protractor-en-legacy-code.html';

            var disqus_config = function () {
                this.language = "es";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="http://twitter.com/avances123"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                    <li class="list-group-item"><a href="https://plus.google.com/u/0/+FabioRuedaCarrascosa/posts"><i class="fa fa-google-plus-square fa-lg"></i> Google+</a></li>
                  </ul>
                </li>



    <li class="list-group-item"><h4><i class="fa fa-code fa-lg"></i><span class="icon-label">Proyectos</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <i class="fa fa-bitcoin"></i>
            <a href="http://www.cloudtrum.xyz" target="_blank">
                Cloudtrum
            </a>
        </li>
      </ul>
    </li>

    <li class="list-group-item"><h4><a href="https://github.com/avances123"><i class="fa fa-github fa-lg"></i></a><span class="icon-label">Ultimos commits</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </li>
            

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Fabio Rueda              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" height="15" width="80"/></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.fabio.rueda.guru/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.fabio.rueda.guru/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.fabio.rueda.guru/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://blog.fabio.rueda.guru/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'avances123',
                count: 3,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://blog.fabio.rueda.guru/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'avances123'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18805523-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>


<!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.fabio.rueda.guru/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://blog.fabio.rueda.guru/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.fabio.rueda.guru/theme/css/pygments/monokai.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.fabio.rueda.guru/theme/css/style.css" type="text/css"/>

        <link href="http://blog.fabio.rueda.guru/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Blog de Fabio Rueda ATOM Feed"/>


        <link href="http://blog.fabio.rueda.guru/feeds/js.atom.xml" type="application/atom+xml" rel="alternate"
              title="Blog de Fabio Rueda js ATOM Feed"/>
