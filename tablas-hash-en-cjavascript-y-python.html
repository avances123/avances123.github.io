<!DOCTYPE html>
<html lang="es"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Tablas hash en C,Javascript y Python - Blog de Fabio Rueda</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="alternate" hreflang="es" href="http://blog.fabio.xyz" />



<link rel="canonical" href="http://blog.fabio.xyz/tablas-hash-en-cjavascript-y-python.html">

        <meta name="author" content="Fabio Rueda" />
        <meta name="keywords" content="C,js,javascript,python,hash,diccionarios,comparativa" />
        <meta name="description" content="Un amigo necesitaba hacer una funcion hash para un problema concreto, como os podeis imaginar, el problema consistia en que necesitaba buscar en un diccionario muchisimas claves, este proceso necesitaba ser lo mas rapido posible, y segun nuestro cariño a distintos lenguajes ,entre varios decidimos hacer un estudio sobre como ..." />

    <!-- Enable latex plugin -->



    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@avances123">
        <meta name="twitter:creator" content="@avances123">
    <meta name="twitter:domain" content="http://blog.fabio.xyz">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.fabio.xyz/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="http://blog.fabio.xyz/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.fabio.xyz/theme/css/pygments/monokai.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.fabio.xyz/theme/css/style.css" type="text/css"/>

        <link href="http://blog.fabio.xyz/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Blog de Fabio Rueda ATOM Feed"/>


        <link href="http://blog.fabio.xyz/feeds/Python.atom.xml" type="application/atom+xml" rel="alternate"
              title="Blog de Fabio Rueda Python ATOM Feed"/>

    

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.fabio.xyz/" class="navbar-brand">
Blog de Fabio Rueda            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://blog.fabio.xyz/category/javascript.html">Javascript</a>
                        </li>
                        <li >
                            <a href="http://blog.fabio.xyz/category/postgresql.html">Postgresql</a>
                        </li>
                        <li class="active">
                            <a href="http://blog.fabio.xyz/category/python.html">Python</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.fabio.xyz/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archivo</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.fabio.xyz/tablas-hash-en-cjavascript-y-python.html"
                       rel="bookmark"
                       title="Permalink to Tablas hash en C,Javascript y Python">
                        Tablas hash en C,Javascript y Python
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">




<span class="label label-default">Tags</span>
	<a href="http://blog.fabio.xyz/tag/c.html">C</a>
        /
	<a href="http://blog.fabio.xyz/tag/js.html">js</a>
        /
	<a href="http://blog.fabio.xyz/tag/javascript.html">javascript</a>
        /
	<a href="http://blog.fabio.xyz/tag/python.html">python</a>
        /
	<a href="http://blog.fabio.xyz/tag/hash.html">hash</a>
        /
	<a href="http://blog.fabio.xyz/tag/diccionarios.html">diccionarios</a>
        /
	<a href="http://blog.fabio.xyz/tag/comparativa.html">comparativa</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Un amigo necesitaba hacer una <a href="http://es.wikipedia.org/wiki/Tabla_hash">funcion hash</a> para un problema concreto, como os podeis imaginar, el problema consistia en que necesitaba buscar en un diccionario muchisimas claves, este proceso necesitaba ser lo mas rapido posible, y segun nuestro cariño a distintos lenguajes ,entre varios decidimos hacer un estudio sobre como resolver el problema usando varios: C, javascript y python, sin usar ninguna cosa rara, simplemente usando lo que el lenguaje permita hacer.</p>
<h3>Descripcion del problema</h3>
<p>Tenemos un fichero de texto con miles de lineas del tipo:</p>
<div class="highlight"><pre>x|y  |z |v  |w         |value
9|100|33|100|2014010100|1
9|100|33|100|2014010106|5
</pre></div>


<p>Nuestro objectivo es crear una tabla hash para poder buscar segun los campos de arriba, excepto el ultimo, que es el valor que queremos extraer. Es decir la clave de busqueda seran los valores <em>x,y,z,v,w</em> y el valor el campo <em>value</em></p>
<h3>Javascript</h3>
<p>En javascript un diccionario, es un <a href="http://ecma262-5.com/ELS5_HTML.htm#Section_8.6">objeto</a>, es decir llenariamos un objeto cuyas propiedades son nuestras claves, no entiendo mucho la implementacion de los objetos/diccionarios en javascript asi que cualquier comentario clarificador lo agradeceria mucho.</p>
<p>Creamos las claves concatenando los numeros como un string y le asignamos su valor.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">csv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fast-csv&quot;</span><span class="p">),</span>
    <span class="nx">table</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">csv</span><span class="p">.</span><span class="nx">fromPath</span><span class="p">(</span><span class="s2">&quot;problema.txt&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">headers</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;|&#39;</span> <span class="p">})</span>
 <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;record&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">table</span><span class="p">[</span><span class="nx">data</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">z</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">v</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">w</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">value</span>
 <span class="p">})</span>
</pre></div>


<p>Y recorremos el diccionario:</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">m</span> <span class="o">&lt;</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">m</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
 <span class="nx">value</span> <span class="o">=</span> <span class="nx">table</span><span class="p">[</span><span class="nx">keys</span><span class="p">[</span><span class="nx">m</span><span class="p">]];</span>
<span class="p">}</span>
</pre></div>


<p>Cabe repetir que lejos de entender la implementacion interna de los objetos en javascript, no parece que sea una tabla hash sino un array asociativo, no podemos decidir una funcion hash especifica para nuestro problema.</p>
<h3>Python</h3>
<p>En python los <a href="http://hg.python.org/cpython/file/52f68c95e025/Objects/dictobject.c">diccionarios</a> son tablas hash, ademas, nuestras claves no tienen por que ser tipos basicos, si lo fueran seria bastante parecido al ejemplo de javascript, excepto que son tablas hash reales,aqui esta la implementacion de tuplas como claves. Cualquier objeto puede ser una clave de un diccionario, basta con que cumpla una serie de requisitos en su definicion, debemos especificar un par de cosas:</p>
<ul>
<li>
<p>Como sabremos que un objeto es igual a otro, para ello usaremos el metodo eq en su clase, necesitamos saberlo para decidir cuando hay una colision</p>
</li>
<li>
<p>Definiremos un metodo <a href="https://docs.python.org/2/reference/datamodel.html#object.__hash__">hash</a> para aplicar cualquier funcion que queramos en la construccion/lectura del diccionario. </p>
</li>
</ul>
<p>Vamos a definir nuestra clase para las claves de busqueda:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Key</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">z</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">v</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">w</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        En esta funcion debemos devolver un entero, sera nuestra funcion hash</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="n">req</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">req</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">req</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">req</span><span class="o">.</span><span class="n">v</span><span class="p">,</span><span class="n">req</span><span class="o">.</span><span class="n">w</span><span class="p">))</span>
</pre></div>


<p>Como podemos ver, la funcion hash, nos permite contruir nuestra tabla hash con facilidad, otros ejemplos de funciones hash para este problema:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">req</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1572869</span>

<span class="k">def</span> <span class="nf">integer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="c"># el hash de un entero en python es el propio numero</span>
</pre></div>


<p>Favoreciendonos del lenguaje y de este metodo hash, podemos cambiar su definicion en tiempo de ejecucion, esto nos servira para comparar muchas funciones hash de manera sencilla, pero eso sera en otro post aparte.</p>
<p>Leemos todas las claves</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">dict_scan</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</pre></div>


<h3>C</h3>
<p>En C no existe la estructura diccionario dentro del lenguaje, lo tenemos que hacer nosotros, esto tiene como ventaja que tenemos un control absoluto de como se tiene que comportar, ademas del rendimiento insuperable que tiene un lenguaje compilado como C. No hace falta que igual de insuperable es el tiempo que nos cuesta implementar este problema comparado con los otros dos contendientes, digamos que tenemos tiempo infinito para hacerlo.</p>
<p>La creacion de la estructura de datos la tabla hash es la siguiente:</p>
<div class="highlight"><pre><span class="cp">#include &lt;sys/types.h&gt;</span>
<span class="cp">#include &lt;sys/stat.h&gt;</span>
<span class="cp">#include &lt;sys/time.h&gt;</span>
<span class="cp">#include &lt;fcntl.h&gt;</span>
<span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;unistd.h&gt;</span>

<span class="cp">#define TAMHASH 1572869</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="o">*</span><span class="n">datos</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">num_datos</span><span class="p">;</span>
<span class="p">}</span> <span class="kt">datos_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">k</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span> <span class="kt">hash_datos_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="kt">hash_datos_t</span> <span class="o">*</span><span class="n">datos</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">num_datos</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">num_max_datos</span><span class="p">;</span>
<span class="p">}</span> <span class="kt">hash_node_t</span><span class="p">;</span>
</pre></div>


<p>La funcion hash es totalmente como nosotros queramos</p>
<div class="highlight"><pre><span class="kr">inline</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">hash_key</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">z</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">w</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">%</span> <span class="n">TAMHASH</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Creamos un hash vacio</p>
<div class="highlight"><pre><span class="kt">hash_node_t</span> <span class="o">*</span><span class="nf">hash_create</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">hash_node_t</span> <span class="o">*</span><span class="n">hash</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="n">hash</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">hash_node_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">TAMHASH</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">TAMHASH</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">datos</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">hash_datos_t</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">num_datos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">num_max_datos</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">hash</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Lo llenamos</p>
<div class="highlight"><pre><span class="kr">inline</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">hash_add</span><span class="p">(</span><span class="kt">hash_node_t</span> <span class="o">*</span><span class="n">hash</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">valor</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">ind</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="n">ind</span> <span class="o">=</span> <span class="n">hash_key</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>

  <span class="c1">// comprobamos si existe</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_datos</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_datos</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// no se ha encontrado la información</span>
    <span class="c1">// creamos un elemento nuevo</span>
    <span class="k">if</span><span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_datos</span> <span class="o">==</span> <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_max_datos</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// si hemos llegado al máximo ampliamos</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_max_datos</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">,</span>
        <span class="k">sizeof</span><span class="p">(</span><span class="kt">hash_datos_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_max_datos</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//memcpy(hash[ind].datos[i].k, p, sizeof(int)*5);</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span> <span class="o">=</span> <span class="n">valor</span><span class="p">;</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_datos</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c1">// lo hemos encontrado.</span>
    <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span> <span class="o">=</span> <span class="n">valor</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Metemos cada linea en el hash con la funcion de arriba</span>
<span class="k">for</span><span class="p">(</span><span class="n">linea</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">linea</span> <span class="o">&lt;</span> <span class="n">datos</span><span class="o">-&gt;</span><span class="n">num_datos</span><span class="p">;</span> <span class="n">linea</span><span class="o">+=</span><span class="mi">6</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">hash_add</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">datos</span><span class="o">-&gt;</span><span class="n">datos</span><span class="p">[</span><span class="n">linea</span><span class="p">],</span> <span class="n">datos</span><span class="o">-&gt;</span><span class="n">datos</span><span class="p">[</span><span class="n">linea</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>


<p>Y lo leemos</p>
<div class="highlight"><pre><span class="kr">inline</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">hash_get</span><span class="p">(</span><span class="kt">hash_node_t</span> <span class="o">*</span><span class="n">hash</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">ind</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="n">ind</span> <span class="o">=</span> <span class="n">hash_key</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>

  <span class="c1">// comprobamos si existe</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">num_datos</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
      <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">k</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="p">{</span>
      <span class="n">ret</span> <span class="o">=</span> <span class="n">hash</span><span class="p">[</span><span class="n">ind</span><span class="p">].</span><span class="n">datos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// consultando datos</span>
<span class="k">for</span><span class="p">(</span><span class="n">linea</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">linea</span> <span class="o">&lt;</span> <span class="n">datos</span><span class="o">-&gt;</span><span class="n">num_datos</span><span class="p">;</span> <span class="n">linea</span><span class="o">+=</span><span class="mi">6</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">v</span> <span class="o">=</span> <span class="n">hash_get</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">datos</span><span class="o">-&gt;</span><span class="n">datos</span><span class="p">[</span><span class="n">linea</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>


<h3>Metodo de resolucion de colisiones</h3>
<p>En el caso de C, la tabla hash esta creada con un metodo de resolucion de colisiones del tipo <a href="http://en.wikipedia.org/wiki/Hash_table#Separate_chaining_with_linked_lists">Separate chaining with linked lists</a>, mientras que el metodo que python usa es <a href="http://en.wikipedia.org/wiki/Hash_table#Open_addressing">Open addressing</a>, En esta grafica se ve como se comportan los dos metodos segun lo llena que esta la tabla (load factor), ordenadas menores es mejor.</p>
<p><img alt="Grafica collision compare" src="http://upload.wikimedia.org/wikipedia/commons/1/1c/Hash_table_average_insertion_time.png" /></p>
<h3>Rendimiento</h3>
<p>Aunque no con este codigo (modificado para la explicacion), se hicieron pruebas de los tres lenguajes, siendo vencedor C (con toda optimizacion del codigo posible), y muy cerca quedo <a href="http://pypy.org/">pypy</a> con su funcion built-in de hashear tuplas, mas de tres veces mas lento quedo el cpython 2.7, y javascript en nodejs.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="http://blog.fabio.xyz/protractor-en-legacy-code.html">Protractor en legacy code</a></li>
        <li><a href="http://blog.fabio.xyz/el-problema-de-las-tres-puertas.html">El problema de las tres puertas</a></li>
    </ul>
</section>
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5455185a630e0def"></script>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'avances123'; // required: replace example with your forum shortname

                    var disqus_identifier = 'tablas-hash-en-cjavascript-y-python';
                var disqus_url = 'http://blog.fabio.xyz/tablas-hash-en-cjavascript-y-python.html';

            var disqus_config = function () {
                this.language = "es";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="/pages/acerca-de-mi.html"><i class="fa fa-graduation-cap"></i> Acerca de</a></li>
                    <li class="list-group-item"><a href="http://twitter.com/avances123"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                    <li class="list-group-item"><a href="https://plus.google.com/u/0/+FabioRuedaCarrascosa/posts"><i class="fa fa-google-plus-square fa-lg"></i> Google+</a></li>
                    <li class="list-group-item"><a href="https://www.linkedin.com/pub/fabio-rueda-carrascosa/15/619/394"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
                  </ul>
                </li>



    <li class="list-group-item"><h4><i class="fa fa-cogs fa-lg"></i><span class="icon-label">Proyectos</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <i class="fa fa-bitcoin"></i>
            <a href="http://www.cloudtrum.xyz" target="_blank">
                Cloudtrum
            </a>
        </li>
      </ul>
    </li>

    <li class="list-group-item"><h4><a href="https://github.com/avances123"><i class="fa fa-github fa-lg"></i></a><span class="icon-label">Ultimos commits</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </li>
            

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Fabio Rueda              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" height="15" width="80"/></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.fabio.xyz/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.fabio.xyz/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.fabio.xyz/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://blog.fabio.xyz/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'avances123',
                count: 3,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://blog.fabio.xyz/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'avances123'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18805523-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>


